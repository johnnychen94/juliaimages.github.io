<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Indexed image in 5 minutes · JuliaImages</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../assets/themeswap.js"></script><link href="../../../gridtheme.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../"><img src="../../../../assets/logo.png" alt="JuliaImages logo"/></a><div class="docs-package-name"><span class="docs-autofit">JuliaImages</span></div><form class="docs-search" action="../../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../../">Home</a></li><li><a class="tocitem" href="../../../../install/">Getting started</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../../../tutorials/quickstart/">Quickstart</a></li><li><a class="tocitem" href="../../../../tutorials/arrays_colors/">Arrays, Numbers, and Colors</a></li><li><a class="tocitem" href="../../../../tutorials/conversions_views/">Conversions vs. views</a></li><li><a class="tocitem" href="../../../../tutorials/indexing/">Arrays: more advanced indexing</a></li></ul></li><li><span class="tocitem">Packages</span><ul><li><a class="tocitem" href="../../../../pkgs/">Introduction</a></li><li><a class="tocitem" href="../../../../pkgs/axes/">ImageAxes.jl</a></li><li><a class="tocitem" href="../../../../pkgs/metadata/">ImageMetaData.jl</a></li><li><a class="tocitem" href="../../../../pkgs/segmentation/">ImageSegmentation.jl</a></li><li><a class="tocitem" href="../../../../pkgs/transformations/">ImageTransformations.jl</a></li><li><a class="tocitem" href="../../../../pkgs/features/">ImageFeatures.jl</a></li></ul></li><li><a class="tocitem" href="../../">Demos</a></li><li><a class="tocitem" href="../../../../function_reference/">References</a></li><li><a class="tocitem" href="../../../../api_comparison/">Comparison with other image processing frameworks</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Indexed image in 5 minutes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Indexed image in 5 minutes</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaImages/juliaimages.github.io/blob/source/docs/examples/color_channels/indexed_image.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Indexed-image-in-5-minutes"><a class="docs-heading-anchor" href="#Indexed-image-in-5-minutes">Indexed image in 5 minutes</a><a id="Indexed-image-in-5-minutes-1"></a><a class="docs-heading-anchor-permalink" href="#Indexed-image-in-5-minutes" title="Permalink"></a></h1><p><a href="../indexed_image.jl"><img src="https://img.shields.io/badge/download-julia-brightgreen.svg" alt="Source code"/></a> <a href="https://nbviewer.jupyter.org/github/JuliaImages/juliaimages.github.io/blob/master/v0.23.3/democards/examples/color_channels/indexed_image.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt="notebook"/></a> <img src="https://img.shields.io/badge/Author-Johnny%20Chen-blue" alt="Author"/> <img src="https://img.shields.io/date/1606089600" alt="Update time"/></p><p>This demonstration shows you how to work with <a href="https://en.wikipedia.org/wiki/Indexed_color">indexed image</a> using <a href="https://github.com/JuliaArrays/IndirectArrays.jl">IndirectArrays.jl</a></p><p>An indexed image consists of two parts: the indices and the palatte. The palatte keeps track of all possible pixel values of an image, while the <code>indices</code> consists of the palatte index of each pixel.</p><pre><code class="language-julia">using Images</code></pre><p>The following is a normally used representation of image, i.e., an image as an array of <code>Colorant</code>s.</p><pre><code class="language-julia">img = [
    RGB(0.0, 0.0, 0.0) RGB(1.0, 0.0, 0.0) RGB(0.0, 1.0, 0.0) RGB(0.0, 0.0, 1.0) RGB(1.0, 1.0, 1.0)
    RGB(1.0, 0.0, 0.0) RGB(0.0, 1.0, 0.0) RGB(0.0, 0.0, 1.0) RGB(1.0, 1.0, 1.0) RGB(0.0, 0.0, 0.0)
    RGB(0.0, 1.0, 0.0) RGB(0.0, 0.0, 1.0) RGB(1.0, 1.0, 1.0) RGB(0.0, 0.0, 0.0) RGB(1.0, 0.0, 0.0)
    RGB(0.0, 0.0, 1.0) RGB(1.0, 1.0, 1.0) RGB(0.0, 0.0, 0.0) RGB(1.0, 0.0, 0.0) RGB(0.0, 1.0, 0.0)
    RGB(1.0, 1.0, 1.0) RGB(0.0, 0.0, 0.0) RGB(1.0, 0.0, 0.0) RGB(0.0, 1.0, 0.0) RGB(0.0, 0.0, 1.0)]</code></pre><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkBAMAAACCzIhnAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAD1BMVEUAAAD/AAAA/wAAAP////+B57DtAAAAAWJLR0QEj2jZUQAAAEtJREFUWMPtzjENwEAMBEFTCIVQeArhjynduXUVRdZs7Tm5Kl3pTic9qRAEWUB+9g6CIB+R6WFPIwiygUwPexpBkA1ketjTCIIsIC9G9Jgv/mYpQwAAAABJRU5ErkJggg==" /><p>Alternatively, we could save it in the indexed image format:</p><pre><code class="language-julia">indices = [1 2 3 4 5; 2 3 4 5 1; 3 4 5 1 2; 4 5 1 2 3; 5 1 2 3 4] # `i` records the pixel value `palatte[i]`
palatte = [RGB(0.0, 0.0, 0.0), RGB(1.0, 0.0, 0.0), RGB(0.0, 1.0, 0.0), RGB(0.0, 0.0, 1.0), RGB(1.0, 1.0, 1.0)]

palatte[indices] == img</code></pre><pre class="documenter-example-output">true</pre><p>This is doable because it follows the Julia <a href="https://docs.julialang.org/en/v1/manual/arrays/#man-supported-index-types">indexing rules</a> that <code>indices</code> is an array of scalar indices, and the dimensionality of the output is the dimensionality of the <code>indices</code>. For example, the following equivalence holds:</p><pre><code class="language-julia">palatte[[1, 2]] == [palatte[1], palatte[2]]
palatte[[1 2; 2 1]] == [palatte[1] palatte[2]; palatte[2] palatte[1]]</code></pre><p>Now, let&#39;s analyze the resource usage of these two approaches. For this example, we are storing the data using type <code>Float64</code>, where each <code>Float64</code> number requires 8 bytes (1 byte=8bits). Hence the normal representation format requires <code>5*5*3*8 = 600</code> bytes storage in total. As a comparison, we only need <code>5*5*8 + 5*3*8 = 320</code> bytes storage if we use the indexed image format. This is why images with few distinct values can often be encoded more compactly as an indexed image.</p><p>Although it does compress the data in this example, in real world applications, it is not always clear whether you should or should not use indexed image format. There are two main drawbacks of it:</p><ul><li>indexed images can require more memory if <code>length(unique(img))</code> is too large.</li><li>indexing into an indexed image requires two <code>getindex</code> operations, so using it can be slower than a direct image representation (and not amenable to SIMD vectorization). This is a typical <a href="https://en.wikipedia.org/wiki/Space%E2%80%93time_tradeoff">space-time tradeoff</a> case.</li></ul><p>Benchmarks are always recommended before you choose to use the indexed image format.</p><p>Using indexed image format with two seperate arrays can be inconvinient, hence <a href="https://github.com/JuliaArrays/IndirectArrays.jl"><code>IndirectArrays.jl</code></a> provides an array abstraction to union these two data:</p><pre><code class="language-julia">using IndirectArrays

indexed_img = IndirectArray(indices, palatte)
img == indexed_img</code></pre><pre class="documenter-example-output">true</pre><p>Under the hook, it is just a simple struct that subtypes <code>AbstractArray</code>:</p><pre><code class="language-julia"># no need to run this
struct IndirectArray{T,N,A,V} &lt;: AbstractArray{T,N}
    index::A
    values::V
end</code></pre><pre><code class="language-julia">indexed_img.index === indices, indexed_img.values === palatte</code></pre><pre class="documenter-example-output">(true, true)</pre><p>Since <code>IndirectArray</code> is just an array, common image operations are applicable to this type, for example:</p><pre><code class="language-julia">imresize(indexed_img; ratio=2) # no longer an IndirectArray</code></pre><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAMAAABHPGVmAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAVFBMVEUAAABAAAC/AAC/QABAvwAAv0AAQL9AQP+/v/////9gEACfMACPYBAwnzAQn3AwYM9gYO+fn8+/v79gjwAQYI+Pn+9gYHBAQECfj49gMDCfEBAAAP/Eus1aAAAAAWJLR0QJ8dml7AAAAMZJREFUaN7t2jcWQjEUxFCTc86w/33SaRp3bl4hLcC3m4O/aY0mNKUZzWlBS1rRmjbUREREiiA5eks72tOBjnSiM13oSiIiIlWQTEiOvlGOvlOOflCOftKLREREqiD5qTAyIW/6UAZLRESkCpIrwciE5OgvZbBERESqILn6j0xI79qRwRIREamC5BPfyIT0rh0ZLBERkSpIPuWPTEjv2pHBEhERqYLkyW5kQnrXjgyWiIhIFSRP83myy6f8kT8C/EhERKQI8gfzZQ/bl1DrzgAAAABJRU5ErkJggg==" /><hr/><p><em>This page was generated using <a href="https://github.com/johnnychen94/DemoCards.jl">DemoCards.jl</a> and <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 29 December 2020 04:19">Tuesday 29 December 2020</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
